---
import type { GetStaticPaths } from 'astro'
import { sortPosts, getTags } from '@lib/util'
import { Page } from '@components'

export const getStaticPaths = (async ({ paginate }) => {
    const posts = await Astro.glob('/src/pages/posts/**/*.{md,mdx}')
    const sorted = sortPosts(posts)
    const tags = getTags(posts)

    return Object.keys(tags).flatMap((tag) =>
        paginate(
            sorted.filter((p) => p.frontmatter.tag?.includes(tag)),
            {
                params: { path: tag ?? undefined },
                props: { tag, tags },
                pageSize: 30,
            },
        ),
    )
}) satisfies GetStaticPaths
---

<Page {...Astro.props} />
