---
import type { GetStaticPaths } from 'astro'
import { sortPosts, getTags } from '@lib/util'
import { Page } from '@components'
import type About from '@src/pages/about.astro'
import type Base from '@src/lib/layouts/base.astro'

export const getStaticPaths = (async ({ paginate }) => {
    const posts = await Astro.glob('/src/pages/posts/**/*.{md,mdx}')
    const sorted = sortPosts(posts)
    const tags = getTags(posts)

    return Object.keys(tags).flatMap((tag) =>
        paginate(
            sorted.filter((p) => p.frontmatter.tag?.includes(tag)),
            {
                params: { path: tag ?? undefined },
                props: { tag, tags },
                pageSize: 30,
            },
        ),
    )
}) satisfies GetStaticPaths

const { page, tag, tags } = Astro.props
---

<Page {page} {tag} {tags} />
